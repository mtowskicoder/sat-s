<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MTOW ‚Äî Katalog</title>
<style>
  :root{
    --bg:#04102a;
    --panel:#07162b;
    --card: rgba(255,255,255,0.03);
    --text:#e8eeff;
    --muted: rgba(232,238,255,0.8);
    --accent:#7c4dff;
  }
  /* Light theme vars */
  body.light {
    --bg: #f6f8fb;
    --panel: #ffffff;
    --card: #ffffff;
    --text: #111827;
    --muted: rgba(17,24,39,0.8);
    --accent: #5b46d8;
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;}
  body{
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* header */
  header{
    height:64px; display:flex; align-items:center; justify-content:space-between;
    padding:0 16px; position:sticky; top:0; background: linear-gradient(90deg, rgba(5,10,20,0.3), rgba(5,10,20,0.15));
    z-index:60; gap:12px;
  }
  .leftControls{display:flex;align-items:center;gap:12px}
  button.iconBtn{
    background:linear-gradient(90deg,var(--accent),#5f3cff);
    color:#021025;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 8px 30px rgba(124,77,255,0.12);
  }
  .title{font-weight:800;color:var(--accent);letter-spacing:0.4px}

  /* layout */
  #app{
    display:flex;
    min-height:calc(100vh - 64px);
    position:relative;
    overflow-x:hidden;
  }

  /* sidebar */
  aside.sidebar{
    position:fixed; left:-300px; top:64px; bottom:0; width:280px; padding:18px; overflow:auto;
    background: linear-gradient(180deg, rgba(6,12,28,0.96), rgba(8,14,30,0.94));
    transition:left .32s cubic-bezier(.2,.9,.2,1); z-index:70; box-shadow:8px 0 40px rgba(2,6,16,0.6);
  }
  body.light aside.sidebar{
    background: linear-gradient(180deg, #ffffff, #fbfdff);
    color:var(--text);
    box-shadow: 8px 0 30px rgba(2,6,16,0.06);
  }
  aside.sidebar.open{ left:0; }
  .sidebar h3{ margin:0 0 12px 0; color:var(--accent); font-size:1.05rem}
  .catItem{ display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px; margin-bottom:10px; cursor:pointer; transition:all .18s; border:1px solid rgba(255,255,255,0.02); background:var(--card)}
  .catItem:hover{ transform:translateX(6px); box-shadow:0 10px 30px rgba(124,77,255,0.06)}
  .catItem img{ width:44px; height:44px; border-radius:8px; object-fit:cover; flex-shrink:0 }
  .catItem .name{ font-weight:700 }
  .homeBtn{ margin-top:8px; padding:10px; border-radius:10px; background:linear-gradient(90deg,var(--accent),#5f3cff); color:#021025; font-weight:800; text-align:center; cursor:pointer }

  /* overlay */
  .overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.35); opacity:0; visibility:hidden; transition:all .2s; z-index:65; }
  .overlay.show{ opacity:1; visibility:visible; }

  /* main content container */
  main.container{ margin:28px auto; width: min(1100px, 96%); position:relative; z-index:10; }
  .announcementCard{
    display:flex; gap:16px; align-items:center; padding:18px; border-radius:12px;
    background: linear-gradient(180deg, rgba(12,22,40,0.6), rgba(6,10,20,0.4));
    border:1px solid rgba(124,77,255,0.04);
    box-shadow:0 12px 40px rgba(3,8,24,0.6);
  }
  .annGif{ width:140px; height:140px; border-radius:12px; object-fit:cover }
  .annText{ font-weight:700; color:var(--muted); line-height:1.2 }

  /* products area */
  .productsArea{ margin-top:22px; display:none; } /* shown when category selected */
  .grid{ margin-top:14px; display:grid; gap:18px; grid-template-columns: repeat(auto-fill, minmax(220px,1fr));}

  .card{
    border-radius:12px; padding:12px; background: linear-gradient(180deg, rgba(8,16,32,0.35), rgba(6,10,20,0.25));
    border:1px solid rgba(255,255,255,0.03); box-shadow:0 10px 30px rgba(2,6,16,0.45); transition:transform .18s, box-shadow .18s;
  }
  .card:hover{ transform:translateY(-6px); box-shadow:0 20px 50px rgba(124,77,255,0.06); }
  .thumb{ height:140px; border-radius:10px; display:flex; align-items:center; justify-content:center; overflow:hidden; background: rgba(255,255,255,0.02) }
  .thumb img{ max-width:100%; max-height:100%; object-fit:contain }
  .card h4{ margin:10px 0 6px 0; color:var(--accent) }
  .card p{ margin:0; color:var(--muted); min-height:36px; font-size:13px }
  .price{ margin-top:8px; font-weight:900; color:#2dd4bf }

  .detailBtn{ margin-top:12px; width:100%; padding:10px; border-radius:10px; border:0; background:linear-gradient(90deg,var(--accent),#5f3cff); color:#021025; font-weight:800; cursor:pointer }

  /* detail view */
  .detailView{ display:none; margin-top:22px; padding:18px; border-radius:12px; background: linear-gradient(180deg, rgba(8,14,28,0.45), rgba(6,10,18,0.22)); border:1px solid rgba(124,77,255,0.03); box-shadow:0 18px 60px rgba(2,6,16,0.6) }
  .detailTop{ display:flex; gap:18px; align-items:center; justify-content:center; flex-wrap:wrap }
  .detailTop img{ width:220px; height:220px; object-fit:cover; border-radius:12px }
  .detailText h3{ margin:0; color:var(--accent) }
  .detailText p{ color:var(--muted) }
  .detailActions{ margin-top:14px; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap }

  .backBtn{ display:none; margin:18px auto 6px; padding:10px 16px; border-radius:10px; border:0; background:#ff6b6b; color:white; font-weight:700; cursor:pointer }

  /* footer */
  footer{ margin:26px auto; text-align:center; color:rgba(255,255,255,0.5); font-size:13px; padding-bottom:26px }

  /* animated background containers per category */
  .bg-anim{ position:fixed; inset:64px 0 0 0; z-index:0; pointer-events:none; opacity:0; transition:opacity .45s ease; }
  .bg-anim.active{ opacity:1; }
  /* gradient animations (soft subtle) */
  .bg-tg{ background: radial-gradient(circle at 10% 20%, rgba(37,186,255,0.08), transparent 15%), linear-gradient(135deg, #09203f 0%, #1a9bdc 100%); animation: move1 8s linear infinite; }
  .bg-wa{ background: radial-gradient(circle at 80% 30%, rgba(37,186,118,0.06), transparent 15%), linear-gradient(135deg, #0d3b2e 0%, #25D366 100%); animation: move2 8s linear infinite; }
  .bg-ig{ background: radial-gradient(circle at 30% 10%, rgba(245,133,41,0.06), transparent 15%), linear-gradient(135deg, #2b0b39 0%, #f58529 100%); animation: move3 9s linear infinite; }
  .bg-tt{ background: radial-gradient(circle at 60% 40%, rgba(255,29,85,0.05), transparent 15%), linear-gradient(135deg, #0b0b0b 0%, #69c9d0 100%); animation: move4 10s linear infinite; }
  .bg-other{ background: radial-gradient(circle at 50% 50%, rgba(124,77,255,0.05), transparent 15%), linear-gradient(135deg,#06102a,#2b1a5b); animation: move1 11s linear infinite; }

  @keyframes move1{ 0%{background-position:0% 0%}50%{background-position:20% 30%}100%{background-position:0% 0%} }
  @keyframes move2{ 0%{background-position:10% 10%}50%{background-position:30% 50%}100%{background-position:10% 10%} }
  @keyframes move3{ 0%{background-position:0% 20%}50%{background-position:40% 10%}100%{background-position:0% 20%} }
  @keyframes move4{ 0%{background-position:0% 0%}50%{background-position:50% 40%}100%{background-position:0% 0%} }

  /* responsive */
  @media(max-width:820px){
    .detailTop{flex-direction:column}
    .detailTop img{width:160px;height:160px}
    .thumb{height:120px}
    aside.sidebar{width:100%; left:-100%}
    aside.sidebar.open{ left:0 }
  }
</style>
</head>
<body>
  <header>
    <div class="leftControls">
      <button id="menuToggle" class="iconBtn">KATEGORƒ∞LER</button>
      <div class="title">MTOW</div>
    </div>
    <div style="display:flex;gap:12px;align-items:center">
      <div style="font-size:13px;color:var(--muted)">¬© 2025 MTOW</div>
      <button id="themeToggle" class="iconBtn" style="padding:6px 10px">üåô</button>
    </div>
  </header>

  <div id="app">
    <aside class="sidebar" id="sidebar" aria-hidden="true">
      <h3>Men√º</h3>
      <div class="homeBtn" id="homeBtn">üè† Ana Sayfa</div>
      <div id="categoryContainer" style="margin-top:14px"></div>
      <div style="margin-top:18px">
        <button id="closeSidebar" style="width:100%;padding:10px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer">Kapat</button>
      </div>
    </aside>

    <div class="overlay" id="overlay"></div>

    <!-- animated backgrounds -->
    <div class="bg-anim bg-tg" id="bg-tg" aria-hidden="true"></div>
    <div class="bg-anim bg-wa" id="bg-wa" aria-hidden="true"></div>
    <div class="bg-anim bg-ig" id="bg-ig" aria-hidden="true"></div>
    <div class="bg-anim bg-tt" id="bg-tt" aria-hidden="true"></div>
    <div class="bg-anim bg-other" id="bg-other" aria-hidden="true"></div>

    <main class="container" role="main">
      <!-- ANNOUNCEMENT (only on home) -->
      <section id="homeSection">
        <div class="announcementCard" role="region" aria-label="Duyurular">
          <img class="annGif" id="annGif" alt="duyuru gif">
          <div class="annText" id="annText">Y√ºkleniyor...</div>
        </div>
      </section>

      <!-- PRODUCTS -->
      <section class="productsArea" id="productsArea" aria-hidden="true">
        <button class="backBtn" id="backFromProducts">‚¨ÖÔ∏è Geri</button>
        <div id="productsTitle" style="text-align:center;margin-top:6px;font-weight:800;color:var(--accent)"></div>
        <div class="grid" id="grid"></div>
      </section>

      <!-- DETAIL -->
      <section class="detailView" id="detailView" aria-hidden="true">
        <button class="backBtn" id="backFromDetail">‚¨ÖÔ∏è Geri</button>
        <div class="detailTop">
          <img id="detailImg" alt="√ºr√ºn g√∂rseli">
          <div class="detailText">
            <h3 id="detailName"></h3>
            <p id="detailDesc"></p>
            <div style="font-weight:900;color:#2dd4bf;margin-top:8px" id="detailPrice"></div>
            <div class="detailActions">
              <button class="buy" id="detailBuy">Satƒ±n Al</button>
            </div>
          </div>
        </div>
      </section>

      <footer style="margin-top:28px;text-align:center;color:rgba(255,255,255,0.45)">
        ¬© 2025 MTOW | mtowskicoder
      </footer>
    </main>
  </div>

<script>
/* CONFIG */
const ANNOUNCE_JSON = 'data/announcements.json';
const CATEGORIES_JSON = 'data/categories.json';
const PRODUCTS_JSON = 'data/products.json';
const TG_BASE = 'https://t.me/mtowi';

/* CATEGORY GIF ICONS (product thumbnail source) */
const GIF_MAP = {
  "Telegram": "https://media3.giphy.com/media/yUHWI1PV3Y4btfmZBE/giphy.gif",
  "Whatsapp": "https://media1.giphy.com/media/DRinNvjCXc5Iexx0CH/giphy.gif",
  "Instagram": "https://media2.giphy.com/media/YwNCU8P5jGMNKGG5Bq/giphy.gif",
  "Tiktok": "https://media0.giphy.com/media/ujwiCsJtRmXdBzJvmm/giphy.gif",
  "default": "https://media3.giphy.com/media/GotXuxqhIZvs4/giphy.gif"
};

/* elements */
const sidebar = document.getElementById('sidebar');
const menuToggle = document.getElementById('menuToggle');
const overlay = document.getElementById('overlay');
const closeSidebar = document.getElementById('closeSidebar');
const categoryContainer = document.getElementById('categoryContainer');
const homeBtn = document.getElementById('homeBtn');

const annGif = document.getElementById('annGif');
const annText = document.getElementById('annText');

const productsArea = document.getElementById('productsArea');
const productsTitle = document.getElementById('productsTitle');
const grid = document.getElementById('grid');
const backFromProducts = document.getElementById('backFromProducts');

const detailView = document.getElementById('detailView');
const detailImg = document.getElementById('detailImg');
const detailName = document.getElementById('detailName');
const detailDesc = document.getElementById('detailDesc');
const detailPrice = document.getElementById('detailPrice');
const detailBuy = document.getElementById('detailBuy');
const backFromDetail = document.getElementById('backFromDetail');

const themeToggle = document.getElementById('themeToggle');

/* background nodes */
const bgNodes = {
  telegram: document.getElementById('bg-tg'),
  whatsapp: document.getElementById('bg-wa'),
  instagram: document.getElementById('bg-ig'),
  tiktok: document.getElementById('bg-tt'),
  other: document.getElementById('bg-other')
};

/* state */
let categories = [];
let products = [];
let currentCategory = null;
let currentProduct = null;

/* load helper */
async function fetchJson(url){
  try{
    const r = await fetch(url, {cache:'no-cache'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    return await r.json();
  }catch(e){
    console.error('fetch error', url, e);
    return null;
  }
}

/* initialize theme from localStorage */
(function initTheme(){
  const t = localStorage.getItem('mtow_theme') || 'dark';
  if(t === 'light') document.body.classList.add('light'), themeToggle.textContent='‚òÄÔ∏è';
  else themeToggle.textContent='üåô';
})();

/* theme toggle */
themeToggle.addEventListener('click', ()=>{
  document.body.classList.toggle('light');
  const mode = document.body.classList.contains('light') ? 'light' : 'dark';
  localStorage.setItem('mtow_theme', mode);
  themeToggle.textContent = mode === 'light' ? '‚òÄÔ∏è' : 'üåô';
});

/* sidebar control */
menuToggle.addEventListener('click', ()=> {
  sidebar.classList.add('open'); overlay.classList.add('show');
  sidebar.setAttribute('aria-hidden','false');
});
closeSidebar.addEventListener('click', ()=> { sidebar.classList.remove('open'); overlay.classList.remove('show'); sidebar.setAttribute('aria-hidden','true');});
overlay.addEventListener('click', ()=> { sidebar.classList.remove('open'); overlay.classList.remove('show'); sidebar.setAttribute('aria-hidden','true');});

/* Home button: her yerden ana sayfaya d√∂ner */
homeBtn.addEventListener('click', ()=> {
  sidebar.classList.remove('open'); overlay.classList.remove('show'); sidebar.setAttribute('aria-hidden','true');
  showHome();
});

/* show/hide animated background */
function showBackgroundFor(categoryId){
  // hide all
  Object.values(bgNodes).forEach(n => n.classList.remove('active'));
  if(!categoryId) return;
  switch((categoryId||'').toLowerCase()){
    case 'telegram': bgNodes.telegram.classList.add('active'); break;
    case 'whatsapp': bgNodes.whatsapp.classList.add('active'); break;
    case 'instagram': bgNodes.instagram.classList.add('active'); break;
    case 'tiktok': bgNodes.tiktok.classList.add('active'); break;
    default: bgNodes.other.classList.add('active'); break;
  }
}

/* render categories in sidebar */
function renderCategories(){
  categoryContainer.innerHTML = '';
  categories.forEach(cat=>{
    const el = document.createElement('div');
    el.className = 'catItem';
    const icon = GIF_MAP[cat.name] || GIF_MAP['default'];
    el.innerHTML = `<img src="${icon}" alt="${cat.name}"><div><div class="name">${escapeHtml(cat.name)}</div><div class="count" style="font-size:12px;color:rgba(255,255,255,0.6)">${products.filter(p=>p.category===cat.name).length} √ºr√ºn</div></div>`;
    el.addEventListener('click', ()=>{
      openCategory(cat.name);
      sidebar.classList.remove('open'); overlay.classList.remove('show');
    });
    categoryContainer.appendChild(el);
  });
}

/* load all data */
async function loadAll(){
  const [a,c,p] = await Promise.all([
    fetchJson(ANNOUNCE_JSON),
    fetchJson(CATEGORIES_JSON),
    fetchJson(PRODUCTS_JSON)
  ]);
  // announcements
  if(a){
    if(Array.isArray(a) && a.length){
      annGif.src = (a[0].gif || annGif.src || GIF_MAP['default']);
      annText.innerHTML = a.map(x=>`<strong>${escapeHtml(x.title||'')}</strong><div style="margin-top:6px;color:var(--muted)">${escapeHtml(x.content||'')}</div>`).join('<hr style="opacity:.06;margin:10px 0">');
    } else if(typeof a === 'object' && a.text){
      annText.textContent = a.text;
    } else {
      annText.textContent = 'Hen√ºz duyuru yok.';
    }
  } else {
    annText.textContent = 'Duyurular y√ºklenemedi.';
  }

  categories = Array.isArray(c) ? c : (c ? Object.values(c) : []);
  products = Array.isArray(p) ? p : (p ? (()=>{ // support object keyed by category
    const arr=[]; for(const k in p){ if(Array.isArray(p[k])) p[k].forEach(it=>{ it.category = it.category || k; arr.push(it); }); } return arr; })() : []);

  // render
  renderCategories();
}

/* open a category: show product grid, animate background */
function openCategory(categoryName){
  currentCategory = categoryName;
  // title
  productsTitle.textContent = categoryName;
  // show area
  document.getElementById('homeSection').style.display = 'none';
  document.getElementById('homeSection').setAttribute('aria-hidden','true');
  productsArea.style.display = 'block';
  productsArea.setAttribute('aria-hidden','false');
  detailView.style.display = 'none';
  detailView.setAttribute('aria-hidden','true');
  // set animated background
  showBackgroundFor(categoryName);
  // populate grid
  grid.innerHTML = '';
  const list = products.filter(p=>p.category === categoryName);
  if(list.length === 0){
    grid.innerHTML = `<div style="padding:20px;color:var(--muted)">Bu kategoride √ºr√ºn yok.</div>`;
    // ensure no back button in category view
    backFromProducts.style.display = 'none';
    return;
  }
  list.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'card';
    const thumbSrc = GIF_MAP[p.category] || GIF_MAP['default'];
    card.innerHTML = `
      <div class="thumb"><img src="${thumbSrc}" alt="${escapeHtml(p.name)}"></div>
      <h4>${escapeHtml(p.name)}</h4>
      <p>${escapeHtml(p.description || p.desc || '')}</p>
      <div class="price">${escapeHtml(p.price || p.fiyat || '')}</div>
      <button class="detailBtn" data-id="${escapeHtml(p.id || p.name)}">Detay</button>
    `;
    // click on thumbnail or title -> detail
    const imgEl = card.querySelector('.thumb img');
    if(imgEl) imgEl.addEventListener('click', ()=> openDetail(p));
    const titleEl = card.querySelector('h4');
    if(titleEl) titleEl.addEventListener('click', ()=> openDetail(p));
    // detail button -> open detail
    card.querySelector('button.detailBtn').addEventListener('click', (e)=>{
      e.stopPropagation();
      openDetail(p);
    });
    grid.appendChild(card);
  });
  // ensure no back button in category view
  backFromProducts.style.display = 'none';
  backFromProducts.setAttribute('aria-hidden','true');
}

/* open product detail */
function openDetail(p){
  currentProduct = p;
  detailImg.src = GIF_MAP[p.category] || GIF_MAP['default'];
  detailName.textContent = p.name || '';
  detailDesc.textContent = (p.description || p.desc || '').trim() || 'A√ßƒ±klama yok.';
  detailPrice.textContent = p.price || p.fiyat || '';
  // show/hide
  productsArea.style.display = 'none';
  productsArea.setAttribute('aria-hidden','true');
  document.getElementById('homeSection').style.display = 'none';
  document.getElementById('homeSection').setAttribute('aria-hidden','true');
  detailView.style.display = 'block';
  detailView.setAttribute('aria-hidden','false');
  // show back button in detail and buy button
  backFromDetail.style.display = 'block';
  backFromDetail.setAttribute('aria-hidden','false');
  detailBuy.style.display = 'inline-block';
  detailBuy.setAttribute('aria-hidden','false');

  backFromDetail.onclick = ()=> {
    // go back to product list (same category) if category exists, else home
    if(currentCategory){
      openCategory(currentCategory);
    } else {
      showHome();
    }
  };
  detailBuy.onclick = ()=> buyFlow(p);
}

/* buy: open telegram with pre-filled message */
function buyFlow(p){
  const name = p.name || '';
  const price = p.price || '';
  const cat = p.category || currentCategory || '';
  const desc = p.description || p.desc || '';
  const msg = `Merhaba!\n\n√úr√ºn: ${name}\nKategori: ${cat}\nFiyat: ${price}\nDetay: ${desc}`;
  const url = `${TG_BASE}?text=${encodeURIComponent(msg)}`;
  window.open(url,'_blank');
}

/* show home */
function showHome(){
  currentCategory = null;
  currentProduct = null;
  productsArea.style.display = 'none';
  productsArea.setAttribute('aria-hidden','true');
  detailView.style.display = 'none';
  detailView.setAttribute('aria-hidden','true');
  document.getElementById('homeSection').style.display = 'block';
  document.getElementById('homeSection').setAttribute('aria-hidden','false');
  backFromProducts.style.display = 'none';
  backFromProducts.setAttribute('aria-hidden','true');
  backFromDetail.style.display = 'none';
  backFromDetail.setAttribute('aria-hidden','true');
  detailBuy.style.display = 'none';
  detailBuy.setAttribute('aria-hidden','true');
  showBackgroundFor(null);
}

/* utilities */
function escapeHtml(s){ if(s===null||s===undefined) return ''; return String(s).replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }

/* keyboard accessibility: Esc closes panels / goes home from detail */
document.addEventListener('keydown',(e)=>{
  if(e.key==='Escape'){
    if(sidebar.classList.contains('open')){ sidebar.classList.remove('open'); overlay.classList.remove('show'); }
    else if(detailView.style.display === 'block'){ showHome(); }
    else { showHome(); }
  }
});

/* initial load */
(async function init(){
  // set announcement gif default (provided)
  annGif.src = GIF_MAP['default'];
  // load data
  await loadAll();
  // default show home
  showHome();
})();
</script>
</body>
</html>
